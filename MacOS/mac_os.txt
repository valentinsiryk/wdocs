======
Mac OS
======


Allow only ssh key authentication ``/etc/ssh/sshd_config``::

    PasswordAuthentication no
    ChallengeResponseAuthentication no


Control autoupdate::

    # https://derflounder.wordpress.com/2014/12/29/managing-automatic-app-store-and-os-x-update-installation-on-yosemite/
    # to disable the automatic update check
    softwareupdate --schedule off
    # or
    defaults write /Library/Preferences/com.apple.SoftwareUpdate AutomaticCheckEnabled -bool FALSE


Allow to install apps::

    sudo spctl --master-disable


Switch user::

    uid=`id -u ${username}`    
    /System/Library/CoreServices/Menu\ Extras/User.menu/Contents/Resources/CGSession -switchToUserID ${uid}


Restart Screensharing::

    sudo launchctl unload /System/Library/LaunchDaemons/com.apple.screensharing.plist  
    sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.screensharing.plist


Enable/disable fast user switching::

    # enable
    sudo defaults write /Library/Preferences/.GlobalPreferences MultipleSessionEnabled -bool YES
    
    # disable
    sudo defaults write /Library/Preferences/.GlobalPreferences MultipleSessionEnabled -bool no
    

Open multiple instances of application::

    open -na "Messages"
    open -n /Applications/Messages.app/Contents/MacOS/Messages
    
    
Run application at another user::

    sudo login -f <username> /Applications/Messages.app/Contents/MacOS/Messages


Remote connect::

    https://support.apple.com/en-us/HT201710


Create bootable flash
---------------------

Mac OS Sierra - http://www.macworld.com/article/3092900/macs/how-to-create-a-bootable-macos-sierra-installer-drive.html



Brew
----

Installation::

    /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"


Install some app::

    brew install <app>
    
    
System limits
-------------

::

    launchctl limit

    # set limit (before system restart)
    sysctl -w kern.maxproc=2048
    sysctl -w kern.maxfiles=5000
    
    sysctl -a
    
    # show sysem limits
    sysctl kern.maxproc
    sysctl kern.maxfiles

    # show user limits
    ulimit -a
    
    # set user limit
    ulimit -u 2048

    launchctl limit maxfiles 1000000 1000000
    launchctl limit maxproc 1000000 1000000

    # set mac server mode
    sudo serverinfo --setperfmode true


**For 10.9 (Mavericks), 10.10 (Yosemite), 10.11 (El Capitan), and 10.12 (Sierra)**

Create file (owner: root:wheel, mode: 0644) ``/Library/LaunchDaemons/limit.maxfiles.plist``::

    <?xml version="1.0" encoding="UTF-8"?>
    <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
      <plist version="1.0">
        <dict>
          <key>Label</key>
            <string>limit.maxfiles</string>
          <key>ProgramArguments</key>
            <array>
              <string>launchctl</string>
              <string>limit</string>
              <string>maxfiles</string>
              <string>65536</string>
              <string>65536</string>
            </array>
           <key>RunAtLoad</key>
            <true/>
          <key>ServiceIPC</key>
            <false/>
        </dict>
      </plist>


Create file (owner: root:wheel, mode: 0644) ``/Library/LaunchDaemons/limit.maxproc.plist``::

    <?xml version="1.0" encoding="UTF-8"?>
    <!DOCTYPE plist PUBLIC "-//Apple/DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
      <plist version="1.0">
        <dict>
          <key>Label</key>
            <string>limit.maxproc</string>
          <key>ProgramArguments</key>
            <array>
              <string>launchctl</string>
              <string>limit</string>
              <string>maxproc</string>
              <string>2048</string>
              <string>2048</string>
            </array>
          <key>RunAtLoad</key>
            <true />
          <key>ServiceIPC</key>
            <false />
        </dict>
      </plist>
	

	
	



